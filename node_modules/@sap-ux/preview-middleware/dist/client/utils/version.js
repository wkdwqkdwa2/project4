"use strict";

sap.ui.define(["sap/ui/VersionInfo", "sap/base/Log"], function (VersionInfo, Log) {
  "use strict";

  /**
   * Default minimal supported UI5 version
   */
  const minVersionInfo = {
    major: 1,
    minor: 71
  };

  /**
   * Retrieve the UI5 version from sap.ui.core library
   *
   * @returns Ui5VersionInfo
   */
  async function getUi5Version() {
    let version = (await VersionInfo.load({
      library: 'sap.ui.core'
    }))?.version;
    if (!version) {
      Log.error('Could not get UI5 version of application. Using 1.121.0 as fallback.');
      version = '1.121.0';
    }
    const [major, minor] = version.split('.').map(versionPart => parseInt(versionPart, 10));
    return {
      major: major,
      minor: minor
    };
  }

  /**
   * Checks if the given version is lower than the required minimal version.
   * @param ui5VersionInfo to check
   * @param minUi5VersionInfo to check against (default is 1.71)
   *
   * @returns boolean
   */
  function isLowerThanMinimalUi5Version(ui5VersionInfo) {
    let minUi5VersionInfo = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : minVersionInfo;
    if (!isNaN(ui5VersionInfo.major) && !isNaN(ui5VersionInfo.minor)) {
      if (ui5VersionInfo.major < minUi5VersionInfo.major) {
        return true;
      }
      if (ui5VersionInfo.major === minUi5VersionInfo.major && ui5VersionInfo.minor < minUi5VersionInfo.minor) {
        return true;
      }
    }
    return false;
  }

  /**
   * Get UI5 version validation message.
   * @param ui5VersionInfo to be mentioned in the message
   * @returns string with validation message.
   */
  function getUI5VersionValidationMessage(ui5VersionInfo) {
    return `The current SAPUI5 version set for this Adaptation project is ${ui5VersionInfo.major}.${ui5VersionInfo.minor}. The minimum version to use for SAPUI5 Adaptation Project and its SAPUI5 Visual Editor is ${minVersionInfo.major}.${minVersionInfo.minor}`;
  }
  var __exports = {
    __esModule: true
  };
  __exports.getUi5Version = getUi5Version;
  __exports.isLowerThanMinimalUi5Version = isLowerThanMinimalUi5Version;
  __exports.getUI5VersionValidationMessage = getUI5VersionValidationMessage;
  return __exports;
});
//# sourceMappingURL=version.js.map